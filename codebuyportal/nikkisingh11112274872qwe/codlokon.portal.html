<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
   
  <link rel="icon" type="image/x-icon" href="https://codlokon.space/codebuyportal/Gemini_Generated_Image_rczkjnrczkjnrczk.png">
    <title>Codescript Portal</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- EasyInvoice for invoice generation -->
    <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
    <style>
        /* Custom styles for a clean look */
        body {
            font-family: 'Inter', sans-serif;
        }

        /* HTML: <div class="loader"></div> */
        .loader {
            display: inline-grid;
            width: 80px;
            aspect-ratio: 1;
            animation: l12-0 3s linear infinite;
        }

        .loader:before,
        .loader:after {
            content: "";
            grid-area: 1/1;
        }

        .loader:before {
            clip-path: polygon(100% 50%, 83.81% 59.06%, 93.3% 75%, 74.75% 74.75%, 75% 93.3%, 59.06% 83.81%, 50% 100%, 40.94% 83.81%, 25% 93.3%, 25.25% 74.75%, 6.7% 75%, 16.19% 59.06%, 0% 50%, 16.19% 40.94%, 6.7% 25%, 25.25% 25.25%, 25% 6.7%, 40.94% 16.19%, 50% 0%, 59.06% 16.19%, 75% 6.7%, 74.75% 25.25%, 93.3% 25%, 83.81% 40.94%);
            background: #1B325F;
            transform: rotate(0turn) translate(-12.5%) rotate(0turn);
            animation:
                l12-1 2s linear infinite,
                l12-2 4s linear infinite alternate;
        }

        .loader:after {
            margin: 12.5%;
            clip-path: polygon(100% 50%, 78.19% 60.26%, 88.3% 82.14%, 65% 75.98%, 58.68% 99.24%, 44.79% 79.54%, 25% 93.3%, 27.02% 69.28%, 3.02% 67.1%, 20% 50%, 3.02% 32.9%, 27.02% 30.72%, 25% 6.7%, 44.79% 20.46%, 58.68% 0.76%, 65% 24.02%, 88.3% 17.86%, 78.19% 39.74%);
            background: #9CC4E4;
            animation: l12-3 4s linear infinite alternate;
        }

        @keyframes l12-0 {
            to {
                rotate: 1turn;
            }
        }

        @keyframes l12-1 {
            to {
                transform: rotate(-1turn) translate(-12.5%) rotate(.75turn);
            }
        }

        @keyframes l12-2 {

            90%,
            to {
                clip-path: polygon(100% 50%, 98.3% 62.94%, 93.3% 75%, 85.36% 85.36%, 75% 93.3%, 62.94% 98.3%, 50% 100%, 37.06% 98.3%, 25% 93.3%, 14.64% 85.36%, 6.7% 75%, 1.7% 62.94%, 0% 50%, 1.7% 37.06%, 6.7% 25%, 14.64% 14.64%, 25% 6.7%, 37.06% 1.7%, 50% 0%, 62.94% 1.7%, 75% 6.7%, 85.36% 14.64%, 93.3% 25%, 98.3% 37.06%)
            }
        }

        @keyframes l12-3 {

            90%,
            to {
                clip-path: polygon(100% 50%, 96.98% 67.1%, 88.3% 82.14%, 75% 93.3%, 58.68% 99.24%, 41.32% 99.24%, 25% 93.3%, 11.7% 82.14%, 3.02% 67.1%, 0% 50%, 3.02% 32.9%, 11.7% 17.86%, 25% 6.7%, 41.32% 0.76%, 58.68% 0.76%, 75% 6.7%, 88.3% 17.86%, 96.98% 32.9%)
            }
        }

        /* Style for the active tab */
        .tab-active {
            border-bottom: 2px solid #4f46e5;
            /* indigo-600 */
            color: #4f46e5;
            font-weight: 600;
        }

        .sub-tab-button.sub-tab-active {
            color: #4f46e5;
            border-bottom: 2px solid #4f46e5;
            font-weight: 600;
        }

        /* Simple transition for UI elements */
        .transition-all {
            transition: all 0.3s ease-in-out;
        }

        /* Styles for pagination buttons */
        .pagination-btn {
            padding: 8px 16px;
            border: 1px solid #e5e7eb;
            /* gray-200 */
            background-color: white;
            color: #4b5563;
            /* gray-600 */
            border-radius: 8px;
            cursor: pointer;
        }

        .pagination-btn:hover {
            background-color: #f3f4f6;
            /* gray-100 */
        }

        .pagination-btn.active {
            background-color: #4f46e5;
            /* indigo-600 */
            color: white;
            border-color: #4f46e5;
        }

        .pagination-btn:disabled {
            background-color: #f9fafb;
            /* gray-50 */
            color: #9ca3af;
            /* gray-400 */
            cursor: not-allowed;
        }

        /* Styling for details/summary dropdown */
        details>summary {
            list-style: none;
        }

        details>summary::-webkit-details-marker {
            display: none;
        }

        details[open] summary .arrow {
            transform: rotate(90deg);
        }

        .arrow {
            transition: transform 0.2s;
        }

        /* Animation for the confirmation modal */
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-animate {
            animation: fadeInScale 0.2s ease-out forwards;
        }

        .project-folder:hover .folder-icon {
            transform: scale(1.1);
        }

        .folder-icon {
            transition: transform 0.2s ease-in-out;
        }
    </style>
</head>

<body class="bg-gray-100">
    <!-- Message for mobile/tablet -->
    <div class="lg:hidden w-full min-h-screen flex items-center justify-center p-4 text-center">
        <div class="bg-white p-8 rounded-xl shadow-lg max-w-md mx-auto">
            <h1 class="text-2xl font-bold text-gray-800">Unsupported Device</h1>
            <p class="mt-4 text-gray-600">This portal cannot be opened on phone or tablet. Can only access on PC browser.</p>
        </div>
    </div>

    <!-- Main content for desktop -->
    <div class="hidden lg:block">
        <div class="w-full min-h-screen flex items-center justify-center p-4">
            <!-- Loader (hidden by default) -->
            <div class="loader" id="loader" style="display:none;"></div>
            <!-- =========== Login Page =========== -->
            <div id="login-page" class="w-full max-w-md p-8 space-y-6 bg-white rounded-xl shadow-lg">
                <div>
                    <h1 class="text-3xl font-bold text-center text-gray-800">Secure Portal Login</h1>
                    <p class="text-center text-gray-500">Please enter your password to continue</p>
                </div>
                <form id="login-form" class="space-y-6">
                    <div>
                        <label for="password" class="text-sm font-medium text-gray-700">Password</label>
                        <input type="password" id="password" name="password" required
                            class="w-full px-4 py-2 mt-2 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <button type="submit"
                            class="w-full px-4 py-2 font-semibold text-white bg-gray-700 rounded-lg hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-900 transition-all">
                            Login
                        </button>
                    </div>
                    <p id="error-message" class="text-center text-sm text-red-600 h-4"></p>
                </form>
            </div>

            <!-- =========== Home Page / Project Selector (Initially hidden) =========== -->
            <div id="home-page" class="hidden w-full max-w-6xl p-8 space-y-6 bg-white rounded-xl shadow-lg">
                <header class="pb-4 border-b border-gray-200">
                    <h1 class="text-3xl font-bold text-gray-800">My Projects</h1>
                    <p class="text-gray-500">Select a project to manage its scripts and finances.</p>
                </header>
                <div id="project-folders-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 pt-6">
                    <!-- Project folders will be dynamically inserted here -->
                </div>
            </div>


            <!-- =========== Main Portal (Initially hidden) =========== -->
            <div id="portal-main"
                class="hidden w-full h-full md:h-auto md:max-w-6xl mx-auto bg-white rounded-xl shadow-2xl md:my-8 overflow-hidden">
                <!-- New Advanced Header -->
                <header id="main-header" class="bg-gray-50 border-b border-gray-200">
                    <div class="px-6 md:px-8 py-3 flex justify-between items-center">
                        <!-- Left Side: User Info -->
                        <div>
                            <button id="back-to-projects-btn"
                                class="text-sm font-medium text-indigo-600 hover:text-indigo-800 mb-1">&larr; All
                                Projects</button>
                            <h2 id="current-project-name" class="text-lg font-bold text-gray-800"></h2>
                        </div>
                        <!-- Right Side: Dropdown Menu -->
                        <div class="relative">
                            <button id="profile-menu-button"
                                class="flex items-center text-sm font-medium text-gray-600 hover:text-gray-800 focus:outline-none rounded-full p-2 hover:bg-gray-200">
                                <span>Manage Profile</span>
                                <svg class="w-5 h-5 ml-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                    fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a 1 1 0 010-1.414z"
                                        clip-rule="evenodd" />
                                </svg>
                            </button>
                            <div id="profile-menu"
                                class="hidden absolute right-0 mt-2 w-56 origin-top-right bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none z-10"
                                role="menu">
                                <div class="py-1">
                                    <a href="#" id="account-link"
                                        class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                                        role="menuitem">Account Profile</a>
                                    <a href="#" id="payments-link"
                                        class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                                        role="menuitem">Payments</a>
                                   
                                </div>
                            </div>
                        </div>
                    </div>
                </header>

                <div class="p-6 md:p-8">
                    <header class="pb-4 border-b border-gray-200">
                        <h1 class="text-3xl font-bold text-gray-800">Scripts Dashboard</h1>
                        <p class="text-gray-500">Manage your development scripts and invoices for this project.</p>
                    </header>

                    <!-- Tab Navigation -->
                    <nav class="mt-6">
                        <div class="flex border-b border-gray-200">
                            <button data-tab="dev" class="tab-button px-6 py-3 text-gray-600">In Development
                                Scripts</button>
                            <button data-tab="invoice" class="tab-button px-6 py-3 text-gray-600">Invoice Section</button>
                            <button data-tab="get" class="tab-button px-6 py-3 text-gray-600">Get Scripts</button>
                            <button data-tab="update" class="tab-button px-6 py-3 text-gray-600">Update Scripts</button>
                        </div>
                    </nav>

                    <!-- Tab Content -->
                    <main id="tab-content" class="pt-6">
                        <!-- In Development Scripts -->
                        <div id="dev-tab" class="tab-pane">
                            <div
                                class="flex flex-col md:flex-row justify-end items-center space-y-3 md:space-y-0 md:space-x-4 mb-4">
                                <div class="flex items-center space-x-2"><label for="date-from"
                                        class="text-sm font-medium text-gray-600">From:</label><input type="date"
                                        id="date-from"
                                        class="p-2 border border-gray-300 rounded-md text-sm focus:ring-indigo-500 focus:border-indigo-500"><label
                                        for="date-to" class="text-sm font-medium text-gray-600">To:</label><input
                                        type="date" id="date-to"
                                        class="p-2 border border-gray-300 rounded-md text-sm focus:ring-indigo-500 focus:border-indigo-500"><button
                                        id="filter-date-btn"
                                        class="px-3 py-2 text-sm font-medium text-white bg-indigo-600 rounded-lg hover:bg-indigo-700">Filter</button><button
                                        id="clear-filter-btn"
                                        class="px-3 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300">Clear</button>
                                </div>
                                <div class="flex items-center space-x-2"><label for="sort-scripts"
                                        class="text-sm font-medium text-gray-600">Sort by:</label><select id="sort-scripts"
                                        class="p-2 border border-gray-300 rounded-md text-sm focus:ring-indigo-500 focus:border-indigo-500">
                                        <option value="date-desc">Date (Newest First)</option>
                                        <option value="date-asc">Date (Oldest First)</option>
                                        <option value="price-desc">Price (High to Low)</option>
                                        <option value="price-asc">Price (Low to High)</option>
                                        <option value="name-asc">Name (A-Z)</option>
                                        <option value="name-desc">Name (Z-A)</option>
                                    </select></div>
                            </div>
                            <div id="dev-scripts-list" class="space-y-4"></div>
                        </div>
                        <!-- Invoice Section -->
                        <div id="invoice-tab" class="tab-pane hidden">
                            <div id="invoice-list" class="space-y-4"></div>
                        </div>
                        <!-- Get Scripts -->
                        <div id="get-tab" class="tab-pane hidden">
                            <div class="mb-4 border-b border-gray-200">
                                <nav class="-mb-px flex space-x-4 overflow-x-auto" aria-label="Tabs">
                                    <button data-subtab="frontend"
                                        class="sub-tab-button sub-tab-active whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm">Frontend
                                        Code</button>
                                    <button data-subtab="backend"
                                        class="sub-tab-button whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm">Backend
                                        Code</button>
                                    <button data-subtab="nodejs"
                                        class="sub-tab-button whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm">Node.js
                                        Backend</button>
                                    <button data-subtab="ui"
                                        class="sub-tab-button whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm">UI
                                        Essentials</button>
                                    <button data-subtab="database"
                                        class="sub-tab-button whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm">Database
                                        Essentials</button>
                                </nav>
                            </div>
                            <div id="get-scripts-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                            <div id="pagination-controls" class="flex justify-center items-center space-x-2 mt-6"></div>
                        </div>
                         <!-- Update Scripts -->
                         <div id="update-tab" class="tab-pane hidden">
                            <div id="update-scripts-content" class="text-center py-10 bg-gray-50 rounded-lg">
                                <!-- Content will be dynamically inserted here -->
                            </div>
                        </div>
                    </main>
                </div>
            </div>

            <!-- Other Pages -->
            <div id="account-page" class="hidden w-full max-w-6xl p-8 space-y-6 bg-white rounded-xl shadow-lg">
                <div class="flex justify-between items-center border-b pb-4">
                    <h1 class="text-3xl font-bold text-gray-800">Account Details</h1><button
                        id="back-to-portal-from-account"
                        class="text-sm font-medium text-indigo-600 hover:text-indigo-800">&larr; Back to Dashboard</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 pt-4">
                    <div class="bg-gray-50 p-6 rounded-lg border">
                        <h2 class="text-xl font-semibold text-gray-700 border-b pb-3 mb-4">Personal Information</h2>
                        <div class="space-y-4 text-sm">
                            <div><label class="text-gray-500">Full Name</label>
                                <p class="w-full bg-gray-200 p-2 rounded mt-1 text-gray-800">Nakul Singh</p>
                            </div>
                            <div><label class="text-gray-500">Developer ID</label>
                                <p class="w-full bg-gray-200 p-2 rounded mt-1 text-gray-800 font-mono">DEV-ID
                                    ery363dgb4h4ynf</p>
                            </div>
                            <div><label class="text-gray-500">Email Address</label>
                                <p class="w-full bg-gray-200 p-2 rounded mt-1 text-gray-800">nikkikkc04@gmail.com</p>
                            </div>
                            <div><label class="text-gray-500">Phone Number</label>
                                <p class="w-full bg-gray-200 p-2 rounded mt-1 text-gray-800">+91 8319032699</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-lg border">
                        <h2 class="text-xl font-semibold text-gray-700 border-b pb-3 mb-4">Bank & Payment Details</h2>
                        <div class="space-y-4 text-sm">
                            <div><label class="text-gray-500">Bank Name</label>
                                <p class="w-full bg-gray-200 p-2 rounded mt-1 text-gray-800">UCO BANK INDIA</p>
                            </div>
                            <div><label class="text-gray-500">Account Number</label>
                                <p class="w-full bg-gray-200 p-2 rounded mt-1 text-gray-800 font-mono">XXXX-XXXX-XXXX-6673
                                </p>
                            </div>
                            <div><label class="text-gray-500">Branch & IFSC Code</label>
                                <p class="w-full bg-gray-200 p-2 rounded mt-1 text-gray-800">OBEIDULLAHGANJ Main Branch /
                                    UCBA0000259</p>
                            </div>
                        </div>
                        <div class="mt-6 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 p-4 rounded-r-lg"
                            role="alert">
                            <p class="font-bold">Security Notice</p>
                            <p class="text-sm">For your protection, personal and bank details are read-only and cannot be change or alter. All payments
                                and transactions are locked to this account to prevent fraud. Please contact support for any
                                verification or updates.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div id="checkout-page" class="hidden w-full max-w-6xl p-8 space-y-6 bg-white rounded-xl shadow-lg">
                <div class="flex justify-between items-center border-b pb-4">
                    <h1 class="text-3xl font-bold text-gray-800">Checkout</h1><button id="back-to-portal"
                        class="text-sm font-medium text-indigo-600 hover:text-indigo-800">&larr; Back to Dashboard</button>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-5 gap-8 pt-4">
                    <div class="lg:col-span-2 space-y-8">
                        <div class="bg-gray-50 p-6 rounded-lg border">
                            <h2 class="text-xl font-semibold text-gray-700 border-b pb-3">Order Summary</h2>
                            <div class="space-y-3 mt-4">
                                <div class="flex justify-between"><span class="text-gray-600">Item:</span><span
                                        id="checkout-item-name" class="font-semibold text-gray-800 text-right"></span></div>
                                <div class="flex justify-between"><span class="text-gray-600">Price:</span><span
                                        id="checkout-item-price" class="font-semibold text-gray-800"></span></div>
                                <div class="flex justify-between text-sm" id="discount-row" style="display: none;"><span
                                        class="text-green-600">Discount (10%):</span><span id="checkout-discount-amount"
                                        class="font-semibold text-green-600"></span></div>
                            </div>
                            <div class="border-t mt-4 pt-4">
                                <div class="flex justify-between font-bold text-lg"><span>Total:</span><span
                                        id="checkout-total-price"></span></div>
                            </div>
                        </div>
                        <div class="bg-gray-50 p-6 rounded-lg border">
                            <h2 class="text-xl font-semibold text-gray-700 border-b pb-3">Payment Details</h2>
                            <div class="mt-4 space-y-4">
                                <div><label class="text-sm font-medium text-gray-700">Payment Method</label>
                                    <div class="flex flex-col mt-2 space-y-2">
                                        <div class="flex items-center p-3 border rounded-lg bg-white">
                                            <img src="visa.png" alt="Visa" class="w-8 h-8 mr-3" onerror="this.onerror=null; this.src='https://upload.wikimedia.org/wikipedia/commons/4/41/Visa_Logo.png';" />
                                            <div>
                                                <div class="font-semibold text-gray-800">Card Payment (Visa)</div>
                                                <div class="text-sm text-gray-600">Nakul Singh</div>
                                                <div class="text-sm font-mono text-gray-700">XXXX XXXX XXXX 0781</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>                            <div><label for="promo-code" class="text-sm font-medium text-gray-700">Promo Code</label>
                                    <div class="flex mt-2"><input type="text" id="promo-code"
                                            class="w-full px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"><button
                                            id="apply-promo"
                                            class="px-4 py-2 font-semibold text-white bg-gray-700 rounded-r-lg hover:bg-gray-800">Apply</button>
                                    </div>
                                    <p id="promo-message" class="text-sm h-4 mt-1"></p>
                                </div><button id="final-pay-btn"
                                    class="w-full px-4 py-3 font-semibold text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-900 transition-all"
                                    style="color:whitesmoke">Pay Now</button>
                            </div>
                        </div>
                    </div>
                    <!-- <div class="lg:col-span-3 bg-gray-50 p-6 rounded-lg border">
                        <h2 class="text-xl font-semibold text-gray-700 border-b pb-3 mb-4">Cost Breakdown & Analytics</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
                            <div class="w-full h-64"><canvas id="cost-pie-chart"></canvas></div>
                            <div class="w-full h-64"><canvas id="cost-bar-chart"></canvas></div>
                        </div>
                    </div> -->
                </div>
            </div>
            <div id="payments-page" class="hidden w-full max-w-6xl p-8 space-y-6 bg-white rounded-xl shadow-lg">
                <div class="flex justify-between items-center border-b pb-4">
                    <h1 class="text-3xl font-bold text-gray-800">Payments & Analytics</h1><button
                        id="back-to-portal-from-payments"
                        class="text-sm font-medium text-indigo-600 hover:text-indigo-800">&larr; Back to Dashboard</button>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 pt-4">
                    <div
                        class="lg:col-span-1 bg-gray-50 p-6 rounded-lg border flex flex-col items-center justify-center text-center">
                        <h2 class="text-xl font-semibold text-gray-700">Total Project Investment</h2>
                        <p id="total-investment-amount" class="text-5xl font-bold text-indigo-600 my-4">$0.00</p>
                        <p class="text-gray-500">This is the total amount you've spent on this project's scripts.</p>
                    </div>
                    <div class="lg:col-span-2 bg-gray-50 p-6 rounded-lg border">
                        <h2 class="text-xl font-semibold text-gray-700 border-b pb-3 mb-4">Project Spending Breakdown</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
                            <div class="w-full h-64"><canvas id="total-cost-pie-chart"></canvas></div>
                            <div class="w-full h-64"><canvas id="total-cost-bar-chart"></canvas></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modals -->
            <div id="exchange-modal"
                class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                <div class="bg-white w-full max-w-lg p-6 rounded-xl shadow-2xl space-y-4">
                    <div class="flex justify-between items-center">
                        <h2 id="modal-title" class="text-2xl font-bold text-gray-800">Exchange Script</h2><button
                            id="close-modal" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
                    </div>
                    <!-- Added Warning Popup for Exchange Charges -->
                    <div class="bg-red-50 border-l-4 border-red-400 p-4 mt-2">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-red-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-red-700">
                                    <strong>Warning:</strong> Exchange charges of <span id="modal-exchange-fee" class="font-bold"></span> will be applied to your final invoice when you finalize this code.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="border-t border-gray-200 pt-4">
                        <p class="text-gray-600 mb-4">Please select a different version of the script:</p>
                        <div id="modal-version-list" class="space-y-2"></div>
                    </div>
                </div>
            </div>
            <div id="finalize-confirm-modal"
                class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50">
                <div class="bg-white w-full max-w-md p-6 rounded-xl shadow-2xl text-center space-y-4 modal-animate">
                    <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100">
                        <svg class="h-6 w-6 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                    </div>
                    <h2 class="text-xl font-bold text-gray-800">Are you absolutely sure?</h2>
                    <p class="text-sm text-gray-600">If you proceed, you will finalize this code script. This action cannot
                        be undone. You will be unable to exchange the code in case of any incompatibility or technical
                        issues and will need to purchase a new script.</p>
                    <div class="flex justify-center space-x-4 pt-2"><button id="confirm-cancel-btn"
                            class="px-6 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 border border-gray-300">Cancel</button><button
                            id="confirm-proceed-btn"
                            class="px-6 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700">Proceed</button>
                    </div>
                </div>
            </div>
            <div id="loading-overlay"
                class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-[60] transition-opacity duration-300">
                <div class="flex flex-col items-center space-y-4"><svg class="animate-spin h-12 w-12 text-white"
                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor"
                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                        </path>
                    </svg>
                    <p class="text-white text-lg font-medium">Processing payment, please wait...</p>
                </div>
            </div>
        </div>
        <footer class="w-full text-center p-4">
            <p class="text-gray-500 text-sm">
                &copy; 2025 All Rights Reserved.
            </p>
        </footer>
    </div>


    <script>
        // --- DATA & HELPER FUNCTIONS ---

        function getRandomDate(monthsInFuture = 0) {
            const now = new Date();
            if (monthsInFuture > 0) {
                const futureDate = new Date();
                futureDate.setMonth(futureDate.getMonth() + Math.floor(Math.random() * monthsInFuture) + 1);
                return futureDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            }
            const start = new Date('2025-04-15T00:00:00');
            const end = new Date('2025-09-02T23:59:59');
            const randomDate = new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));
            return randomDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        }

        // New function for deterministic pricing
        function getDeterministicPrice(name, min, max) {
            let hash = 0;
            if (name.length === 0) return min;
            for (let i = 0; i < name.length; i++) {
                const char = name.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash |= 0; // Convert to 32bit integer
            }
            // Simple way to map hash to a price range
            const price = Math.abs(hash) % (max - min + 1) + min;
            return price;
        }
        
        
        const vendors = ['Envato Codes', 'Codester', 'TemplateMonk', 'OCI Servers', 'ScriptJet', 'CodeCanyon'];
        
        const vendorDetails = {
            'Envato Codes': {
                company: 'Envato Codes',
                address: '121 King Street, Melbourne, Australia',
                zip: '3000',
                city: 'Melbourne',
                country: 'Australia'
            },
            'Codester': {
                company: 'Codester',
                address: '456 Script Ave, Amsterdam, Netherlands',
                zip: '1012',
                city: 'Amsterdam',
                country: 'Netherlands'
            },
            'Template Monster': {
                company: 'Template Monster',
                address: '789 Template Rd, London, UK',
                zip: 'E1 6AN',
                city: 'London',
                country: 'United Kingdom'
            },
            'Oracle Servers': {
                company: 'Oracle',
                address: '500 Oracle Parkway, Redwood City, USA',
                zip: '94065',
                city: 'Redwood City',
                country: 'USA'
            },
            'ScriptJet': {
                company: 'ScriptJet',
                address: '101 Jet Way, Berlin, Germany',
                zip: '10115',
                city: 'Berlin',
                country: 'Germany'
            },
            'CodeCanyon': {
                company: 'CodeCanyon by Envato',
                address: '121 King Street, Melbourne, Australia',
                zip: '3000',
                city: 'Melbourne',
                country: 'Australia'
            }
        };
        const fixedDates = [
            'April 26, 2025', 'April 26, 2025', 'April 29, 2025', 'May 03, 2025', 'May 04, 2025',
            'June 17, 2025', 'June 18, 2025', 'July 21, 2025', 'August 12, 2025', 'September 09, 2025','October 02, 2025']
        const purchasedPrice = [73, 83, 74, 82,71, 125, 78, 80,105, 71,40]
        const scriptBaseNames = ["Sign & Log User Authentication e4", "LARACRUD Multipurpose Admin 3rd Level", "Twilio package MS Build-e6675 ", "Blog Platform", "Payment CRM Application", "Payment Gateway Backend Setup EG 2.0", "File Upload Service", "Notification System", "Analytics Tracker Proxy Server gen1","Search For CMS Data Server v9","Redis Caching Layer Throttling v1"]
        //For Get Scripts
        const scriptmarket = ["Sign & Log User Authentication e6", "LARACRUD Admin 6th Level", "MOLD pro Admin Panel", "Gravity Template setup ", "Payment Plugin for Ruoom - Django", "Payment Gateway Frontend EG 6.0", "File Upload Service", "Notification System", "Search Engine", "Clarity Analytics Tracker Proxy Server gen7", "Subscription Manager", "Inventory System", "Booking Engine", "Redis Caching Layer Throttling v6", "Social Media Feed", "API Gateway", "Load Balancer", "Caching Service", "Image Processor", "Video Streaming", "Geo-location Service", "Recommendation Engine", "A/B Testing Framework", "Ad Server", "Survey Builder", "Form Processor", "User Profile Manager", "Reporting Tool", "Workflow Automation", "Data Importer/Exporter", "Coupon Code Generator", "Affiliate Tracking", "Real-time Collaboration", "Document Editor", "Calendar & Scheduling", "Email Marketing", "Help Desk & Ticketing", "Knowledge Base", "Community Forum", "Gamification Engine", "Loyalty Program", "Multi-language Support", "Invoice Generator", "Shipping Calculator", "Order Tracking", "Product Review System", "Wishlist Manager", "Gift Card System", "Data Visualization", "Machine Learning Model", "Natural Language Processor", "Blockchain Integration", "IoT Device Connector", "Web Scraper", "Automation Bot", "Security Scanner", "Backup & Restore", "Server Provisioning", "Log Management"];
        
        const nodejsBaseNames = ["User Authentication", "Express API Server","ACE Cloud CDN M-Kit code New Cache Mechanism v2.1","ACE Cloud Server Setup code With integrated CLI v2.3", "eSCloud Cloud Server Setup With integrated CLI","OCI CDN server v6","eSCloud Extracted Cloud M-kit v1.2.9","eSCloud Extracted Cloud M-kit v1.6.1","eSCloud Extracted Cloud M-kit v1.4.1","Socket.IO Chat Server", "GraphQL API Gateway", "JWT Authentication Service Oauth Enabled", "Stripe Payment Processor E67.90", "WebSocket Real-time Feed", "OAuth2 Provider", "MongoDB Data Service", "Redis Caching Layer", "Puppeteer Web Scraper Setup Code v2.8", "ACE Cloud CDN M-Kit code New Cache Mechanism v5.1","Nodemailer Email Service", "BullMQ Job Queue", "Next.js SSR App", "NestJS Microservice", "AdonisJS Framework", "FeathersJS Real-time API"];
        const uiEssentialsBaseNames = ["Gravity Html Template", "Glassmorphism Card Set", "Neumorphic UI Kit", "Interactive Chart Library", "Customizable Form Elements", "Draggable Kanban Board", "SVG Icon Pack (Pro)", "Parallax Scrolling Engine", "Responsive Navigation Menu", "Date & Time Picker Suite", "Gradient Generator Tool", "Themeable Component Library", "SVG Shape Generator", "CSS Animation Toolkit", "Advanced Tooltip System", "Interactive Map Toolkit", "Photo Gallery with Lightbox", "Video Player Skin", "Landing Page Template Kit", "Dashboard UI Kit", "Onboarding Tour Library", "Notification & Alert System", "Modal & Popup Collection", "WYSIWYG Editor Skin", "Data Table Component", "File Uploader with Progress", "Autocomplete Search Input", "Mega Menu Component", "Social Media Sharing Buttons", "Cookie Consent Banner", "Pricing Table Templates", "Testimonial Slider", "Contact Form with Validation", "FAQ Accordion Component", "Team Showcase Section", "Portfolio Grid Layout", "Coming Soon Page Template", "404 Error Page Kit", "Login/Register Form UI", "User Profile Widget"];
        const databaseEssentialsBaseNames = ["MySQL Managed Instance", "PostgreSQL Cluster", "MongoDB Atlas Replica Set", "Redis In-Memory Cache", "Elasticsearch Cluster", "Firebase Realtime DB", "Amazon DynamoDB Instance", "Google Cloud Spanner", "Microsoft Azure Cosmos DB", "SQLite Embeddable DB", "Neo4j Graph Database", "InfluxDB Time-Series DB", "Cassandra Cluster", "MariaDB Server", "RethinkDB Instance", "CouchDB Server", "ClickHouse OLAP DB", "Oracle DB Instance", "SQL Server Express", "FaunaDB Serverless", "Supabase Postgres Instance", "PlanetScale MySQL", "CockroachDB Distributed SQL", "ScyllaDB NoSQL Cluster", "TiDB NewSQL Platform", "ArangoDB Multi-model", "Realm Mobile Database", "Datastax Astra (Cassandra)", "Heroku Postgres", "DigitalOcean Managed PostgreSQL", "Aiven for PostgreSQL", "Upstash Redis", "Memcached Cloud", "TimescaleDB Cloud", "QuestDB Instance", "Vector Database (Pinecone)", "Vector Database (Weaviate)", "SurrealDB Instance", "EdgeDB Instance", "YugabyteDB Distributed SQL"];

        function generateItems(baseNames, count, generatorFn) {
            const items = [];
            let id = 1;
            while (items.length < count) {
                const name = baseNames[items.length % baseNames.length];
                items.push(generatorFn(name, id++));
            }
            return items;
        }

        let getScripts = [];
        let idCounter = 1;
        const frontendNames = generateItems(scriptmarket, 120, (name, id) => {
            const scriptName = `${name} - Frontend`;
            return {
                id: idCounter++,
                name: scriptName,
                type: 'Frontend',
                exchangeRate: (Math.random() * (50 - 31) + 31).toFixed(2), // Random rate between $11 and $20
               // vendor: vendors[Math.floor(Math.random() * vendors.length)],
                versions: generateVersionTiers(scriptName)
            }
        });
        const backendNames = generateItems(scriptmarket, 120, (name, id) => {
            const scriptName = `${name} - Backend`;
            return {
                id: idCounter++,
                name: scriptName,
                type: 'Backend',
                exchangeRate: (Math.random() * (50 - 31) + 31).toFixed(2), // Random rate
                //vendor: vendors[Math.floor(Math.random() * vendors.length)],
                versions: generateVersionTiers(scriptName)
            }
        });
        const nodejsScripts = generateItems(nodejsBaseNames, 120, (name, id) => {
            const scriptName = `${name} - Node.js Backend`;
            return {
                id: idCounter++,
                name: scriptName,
                type: 'nodejs',
                exchangeRate: (Math.random() * (50 - 31) + 11).toFixed(2), // Random rate
                vendor: vendors[Math.floor(Math.random() * vendors.length)],
                versions: generateVersionTiers(scriptName)
            }
        });
        getScripts = [...frontendNames, ...backendNames, ...nodejsScripts];

        let uiScripts = generateItems(uiEssentialsBaseNames, 120, (name, id) => ({
            id: idCounter++,
            name: name,
            type: 'ui',
            price: getDeterministicPrice(name, 70, 180),
            exchangeRate: (Math.random() * (50 - 31) + 31).toFixed(2), // Random rate
            expiryDate: getRandomDate(12),
           // vendor: vendors[Math.floor(Math.random() * vendors.length)]
        }));

        let databaseScripts = generateItems(databaseEssentialsBaseNames, 120, (name, id) => ({
            id: idCounter++,
            name: name,
            type: 'database',
            setupPrice: getDeterministicPrice(name, 90, 300),
            exchangeRate: (Math.random() * (50 - 31) + 31).toFixed(2), // Random rate
            hourlyRate: (getDeterministicPrice(name + "rate", 9, 49) / 10).toFixed(2),
           // vendor: vendors[Math.floor(Math.random() * vendors.length)]
        }));


        // function generateProjectScripts(count) {
        //     let scripts = [];
        //     const targetTotal = 842.00;
        //     const usedNames = new Set();

        //     let currentTotal = 0;
        //     for (let i = 0; i < count-1; i++) {
        //         let baseName;
        //         do { baseName = scriptBaseNames[i] } while (usedNames.has(baseName));
        //         usedNames.add(baseName);


        //         const remainingScripts = count - i;
        //         const remainingBudget = targetTotal - currentTotal;
        //         const avgPrice = remainingBudget / remainingScripts;
        //         const minPrice = Math.max(40, avgPrice * 0.75);
        //         const maxPrice = Math.min(avgPrice * 1.25, remainingBudget - (remainingScripts - 1) * 40);

        //         let price = purchasedPrice[i]
        //         currentTotal += price;
        //         const allVersions = generateVersionTiers(baseName).map(v => v.name);
        //         const version = `v1.${Math.floor(Math.random() * 9)}`;
        //         const exchangeVersions = allVersions.filter(v => v !== version);

        //         scripts.push({
        //             id: i + 1,
        //             name: baseName,
        //             purchaseDate: fixedDates[i],
        //             status: 'paid',
        //             type: 'Backend',
        //             version: version,
        //             price: price,
        //             vendor: vendors[Math.floor(Math.random() * vendors.length)],
        //             code: `// Code for ${baseName}`,
        //             exchangeVersions: exchangeVersions // <-- store fixed versions
        //         });
        //     }
        //     let lastName;
        //     do { lastName = scriptBaseNames[Math.floor(Math.random() * scriptBaseNames.length)]; } while (usedNames.has(lastName));
        //     const lastPrice = targetTotal - currentTotal;

        //     const lastVersion = `v1.${Math.floor(Math.random() * 9)}`;
        //     const lastExchangeVersions = generateVersionTiers(lastName).map(v => v.name).filter(v => v !== lastVersion);

        //     scripts.push({
        //         id: count,
        //         name: lastName,
        //         status: 'paid',
        //         type: 'Backend',
        //         version: lastVersion,
        //         purchaseDate: getRandomDate(),
        //         price: lastPrice > 0 ? lastPrice : 40,
        //         vendor: vendors[Math.floor(Math.random() * vendors.length)],
        //         code: `// Code for ${lastName}`,
        //         exchangeVersions: lastExchangeVersions // <-- store fixed versions
        //     });

        //     return scripts;
        // }

        const olivireWilsonDates = [
            'January 15, 2023', 'February 02, 2023', 'February 28, 2023', 'March 10, 2023',
            'April 05, 2023', 'April 22, 2023', 'May 18, 2023', 'June 03, 2023'
        ];
        // const scriptBaseNames = ["Sign & Log User Authentication e4", 
        // "LARACRUD Multipurpose Admin 3rd Level", 
        // "Twilio package MS Build-e6675 ", "Blog Platform", "Payment CRM Application", 
        // "Payment Gateway Backend Setup EG 2.0", "File Upload Service", 
        // "Notification System", "Search For CMS", "Analytics Tracker Proxy Server gen1"]
        var usedNames=new Set()
        
        let lastName;
        do { lastName = scriptBaseNames[Math.floor(Math.random() * scriptBaseNames.length)]; } while (usedNames.has(lastName));
       
        const allVersions = generateVersionTiers(lastName).map(v => v.name);
        const version = `v1.${Math.floor(Math.random() * 9)}`;
        const exchangeVersions = allVersions.filter(v => v !== version);
        const lastVersion = `v1.${Math.floor(Math.random() * 9)}`;
        const lastExchangeVersions = generateVersionTiers(lastName).map(v => v.name).filter(v => v !== lastVersion);
       // const purchasedPrice = [73, 83, 74, 82,71, 125, 78, 80,105, 71]
       // const vendors = ['Envato Codes', 'Codester', 'TemplateMon', 'Oracle Servers', 'ScriptJet', 'CodeCanyon'];
        
        const Blinkbag=[
        { id: 1, name: "Sign & Log User Authentication e4", purchaseDate: fixedDates[0], status: 'paid', type: 'Backend', version: lastVersion , price: purchasedPrice[0], vendor: vendors[1], code: "export const signupnow = webMethod(Permissions.Anyone,async (email, password, Name, regT) => {const registrationOptions = {contactInfo: {firstName: Name,},};const registration = await authentication.register(email,password,registrationOptions);let approve = await doApproval(registration.approvalToken);console.log(registration.approvalToken);if (approve.approved == true) {console.log(Member is now registered with the site and pending approval);", 
        exchangeVersions: generateVersionTiers("Sign & Log User Authentication e4").map(v => v.name).filter(v => v !== version) },
            { id: 2, name: "LARACRUD Multipurpose Admin 3rd Level", purchaseDate: fixedDates[1], status: 'paid', type: 'Database', version: lastVersion , price: purchasedPrice[1], vendor: vendors[1], code: "app.put('/update/:key', async (req, res) => { try { const { key } = req.params; const { value } = req.body; if (value === undefined) { return res.status(400).json({ error: 'A new value is required.' }); } // 'XX' option means set only if the key already exists. const result = await redisClient.set(key, value, { XX: true }); if (result === null) { return res.status(404).json({ success: false, message: `Key '${key}' not found. Cannot update.` }); } res.status(200).json({ success: true, message: `Updated key '${key}'.` }); } catch (error) { console.error(error); res.status(500).json({ error: 'Server error occurred.' }); } });",
             exchangeVersions: generateVersionTiers("LARACRUD Multipurpose Admin 3rd Level").map(v => v.name).filter(v => v !== version) },
            { id: 3, name: "Twilio package MS Build-e6675 ", purchaseDate:fixedDates[2], status: 'paid', type: 'Backend', version: lastVersion , price: purchasedPrice[2], vendor: vendors[2], code: "require('dotenv').config();.then(message => console.log(`Message sent successfully! SID: ${message.sid}`)) .catch(error => console.error('Error sending message:', error.message));",
             exchangeVersions: generateVersionTiers("Twilio package MS Build-e6675").map(v => v.name).filter(v => v !== version) },
            { id: 4, name: "SMTP Server Bulk Email Rotation Configuration", purchaseDate: fixedDates[3], status: 'paid', type: 'Backend', version: lastVersion , price: purchasedPrice[3], vendor: vendors[1], code: "triggeredEmails.emailMember(  verifyRegistration,      registration.member._id,      emailOptions,  );triggeredEmails.emailContact( verifyRegistration,      registration.member._id,      emailOptions );",
             exchangeVersions: generateVersionTiers("SMTP Server Bulk Email Rotation Configuration").map(v => v.name).filter(v => v !== version) },
            { id: 5, name: "Payment CRM Application", purchaseDate: fixedDates[4], status: 'paid', type: 'Backend', version: lastVersion , price: purchasedPrice[4], vendor: vendors[1], code: "app.get('/api/payments', (req, res) => { res.json(paymentsDatabase); }); app.post('/api/payments', (req, res) => { const { customerName, amount } = req.body; if (!customerName || !amount) { return res.status(400).json({ error: 'Customer name and amount are required.' }); } currentId++; const newPayment = { id: currentId, customerName, amount: parseFloat(amount), date: new Date().toISOString().split('T')[0]};",
             exchangeVersions: generateVersionTiers("Payment CRM Application").map(v => v.name).filter(v => v !== version) },
            { id: 6, name: "Payment Gateway Headless Server Setup EG 2.0", purchaseDate: fixedDates[5], status: 'paid', type: 'Backend', version: lastVersion , price: purchasedPrice[5], vendor: vendors[3], code: "app.post(/create-stripe-payment, async (req, res) => { try { const { amount, currency } = req.body; const paymentIntent = await stripe.paymentIntents.create({ amount, currency, description: Test Payment, }); res.status(200).json({ clientSecret: paymentIntent.client_secret, message: Stripe Payment Initiated, }); } catch (err) { console.error(Stripe Error:, err); res.status(500).json({ error: err.message }); } }); // -------------------- RAZORPAY CONFIG -------------------- const razorpay = new Razorpay({ key_id: process.env.RAZORPAY_KEY_ID, key_secret: process.env.RAZORPAY_SECRET, }); // Endpoint to create Razorpay order app.post(/create-razorpay-order, async (req, res) => { try { const { amount, currency, receipt } = req.body; const options = { amount: amount, currency: currency ||pound, receipt: receipt || receipt#1, }; const order = await razorpay.orders.create(options); res.status(200).json(order); } catch (err) { console.error(Razorpay Error:, err); res.status(500).json({ error: err.message }); } }); const PORT = process.env.PORT || 5000; app.listen(PORT, () => console.log(' Payment Server running on port ${PORT}`));",
             exchangeVersions: generateVersionTiers("Payment Gateway Backend Setup EG 2.0").map(v => v.name).filter(v => v !== version) },
            { id: 7, name: "File Upload Service", purchaseDate: fixedDates[6], status: 'paid', type: 'Backend', version: lastVersion , price: purchasedPrice[6], vendor: vendors[1], code: "const upload = new tus.Upload(fileContent, {retryDelays: [0, 3000, 5000, 10000, 20000],  metadata: { filename: fileName, contentType: mimeType, token: resumableUploadUrlResponse.uploadToken, },  onError: function (error) { console.log(Failed because:  + error); reject(error); }, onProgress: function (bytesUploaded, bytesTotal) { var percentage = ((bytesUploaded / bytesTotal) * 100).toFixed(2); console.log(bytesUploaded, bytesTotal, percentage + %); $w(#uploading).value = parseInt(percentage) if ($w(#uploading).value == 100) { $w(#uploading).hide() $w(#uploaded).show(puff) } }, onSuccess: async function () { lightbox.close({reopen:reopen}); console.log(Download %s from %s, fileName, upload.url); resolve(true); }, }); $w(#uploading).show() upload.start(); });",
             exchangeVersions: generateVersionTiers("File Upload Service").map(v => v.name).filter(v => v !== version) },
            { id: 8, name: "GPS Navigation Coordinates Receiver v13.8.3", purchaseDate: fixedDates[7], status: 'paid', type: 'Backend', version: lastVersion , price: purchasedPrice[7], vendor: vendors[1], code:  "WindowBackend.getCurrentGeolocation().then((loc) => { console.log(Rider Location:, yo) let locaList = itsbiz.locationBox.distlist console.log(Dist List:, itsbiz.locationBox.distlist) let rider_lat = loc.coords.latitude let rider_long = loc.coords.longitude let time = loc.timestamp let resto_lat = itsbiz.latitude let resto_long = itsbiz.longitude let final_dist = distance(rider_lat, rider_long, resto_lat, resto_long))}",
             exchangeVersions: generateVersionTiers("GPS Navigation Coordinates Receiver v13.8.3").map(v => v.name).filter(v => v !== version) },
            { id: 9, name: "Search For CMS", purchaseDate: fixedDates[8], status: 'paid', type: 'Database', version: lastVersion , price: purchasedPrice[8], vendor: vendors[3], code:"function SearchBy(Name,Email,Phone){ finded.items; let clientRepeater = []; for (var i in arrayfinded) { clientRepeater.push({ _id: i + io+Math.round(funtion SearchBy(Name,Email,Member){Math.random() * 1000), memberName: arrayfinded[i].memberName, _createdDate: arrayfinded[i]._createdDate, reward:arrayfinded[i].reward, phone: arrayfinded[i].phone, }); }",
             exchangeVersions: generateVersionTiers("Search For CMS").map(v => v.name).filter(v => v !== version) },
            { id: 10, name: "Clarity Analytics Tracker Proxy Server gen1", purchaseDate: fixedDates[9], status: 'paid', type: 'Backend', version: lastVersion , price: purchasedPrice[9], vendor: vendors[1], code: "export const ClarityAnalytics = webMethod( Permissions.Admin, async (measurementTypes) => { try { const elevatedGetAnalyticsData = auth.elevate(analyticsData.getAnalyticsData); const response = elevatedGetAnalyticsData(measurementTypes); console.log(Analytics Data:,response) return response; } catch (error) { console.error(error); // Handle the error } }, );", 
            exchangeVersions: generateVersionTiers("Clarity Analytics Tracker Proxy Server gen1").map(v => v.name).filter(v => v !== version) }
            ,{ id: 11, name: "Redis Caching Layer Throttling v1", purchaseDate: fixedDates[10], status: 'paid', type: 'Database', version: lastVersion , price: purchasedPrice[10], vendor: vendors[3], code: "const startServer = async () => { await connectRedis(); // Connects to Redis here app.listen(PORT, () => { console.log(`Server is running on http://localhost:${PORT}`); }); }; startServer();", 
            exchangeVersions: generateVersionTiers("Redis Caching Layer Throttling v1").map(v => v.name).filter(v => v !== version) }


        ]
        const olivireWilsonScripts = [
            { id: 1, name: "User Authentication", purchaseDate: olivireWilsonDates[0], status: 'finalized', type: 'Backend', version: 'v1.1', price: 80, vendor: vendors[0], code: 'finalized', exchangeVersions: generateVersionTiers("User Authentication").map(v => v.name) },
            { id: 2, name: "E-commerce Cart", purchaseDate: olivireWilsonDates[1], status: 'finalized', type: 'Backend', version: 'v1.4', price: 85, vendor: vendors[1], code: 'finalized', exchangeVersions: generateVersionTiers("E-commerce Cart").map(v => v.name) },
            { id: 3, name: "Admin Dashboard", purchaseDate: olivireWilsonDates[2], status: 'finalized', type: 'Backend', version: 'v2.0', price: 75, vendor: vendors[2], code: 'finalized', exchangeVersions: generateVersionTiers("Admin Dashboard").map(v => v.name) },
            { id: 4, name: "Blog Platform", purchaseDate: olivireWilsonDates[3], status: 'finalized', type: 'Backend', version: 'v1.0', price: 90, vendor: vendors[3], code: 'finalized', exchangeVersions: generateVersionTiers("Blog Platform").map(v => v.name) },
            { id: 5, name: "Chat Application", purchaseDate: olivireWilsonDates[4], status: 'finalized', type: 'Backend', version: 'v2.2', price: 82, vendor: vendors[4], code: 'finalized', exchangeVersions: generateVersionTiers("Chat Application").map(v => v.name) },
            { id: 6, name: "Payment Gateway", purchaseDate: olivireWilsonDates[5], status: 'finalized', type: 'Backend', version: 'v3.1', price: 88, vendor: vendors[5], code: 'finalized', exchangeVersions: generateVersionTiers("Payment Gateway").map(v => v.name) },
            { id: 7, name: "File Upload Service", purchaseDate: olivireWilsonDates[6], status: 'finalized', type: 'Backend', version: 'v1.8', price: 72, vendor: vendors[0], code: 'finalized', exchangeVersions: generateVersionTiers("File Upload Service").map(v => v.name) },
            { id: 8, name: "Notification System", purchaseDate: olivireWilsonDates[7], status: 'finalized', type: 'Backend', version: 'v1.5', price: 90, vendor: vendors[1], code: 'finalized', exchangeVersions: generateVersionTiers("Notification System").map(v => v.name) }
        ];

        const eliHealthDates = [
            'September 05, 2023', 'September 21, 2023', 'October 10, 2023', 'October 28, 2023', 'November 15, 2023'
        ];

        const eliHealthScripts = [
            { id: 1, name: "Analytics Tracker", purchaseDate: eliHealthDates[0], status: 'finalized', type: 'Backend', version: 'v1.0', price: 65, vendor: vendors[2], code: 'finalized', exchangeVersions: generateVersionTiers("Analytics Tracker").map(v => v.name) },
            { id: 2, name: "Subscription Manager", purchaseDate: eliHealthDates[1], status: 'finalized', type: 'Backend', version: 'v1.2', price: 70, vendor: vendors[3], code: 'finalized', exchangeVersions: generateVersionTiers("Subscription Manager").map(v => v.name) },
            { id: 3, name: "Inventory System", purchaseDate: eliHealthDates[2], status: 'finalized', type: 'Backend', version: 'v2.1', price: 68, vendor: vendors[4], code: 'finalized', exchangeVersions: generateVersionTiers("Inventory System").map(v => v.name) },
            { id: 4, name: "Booking Engine", purchaseDate: eliHealthDates[3], status: 'finalized', type: 'Backend', version: 'v2.5', price: 72, vendor: vendors[5], code: 'finalized', exchangeVersions: generateVersionTiers("Booking Engine").map(v => v.name) },
            { id: 5, name: "Content Management", purchaseDate: eliHealthDates[4], status: 'finalized', type: 'Backend', version: 'v3.0', price: 65, vendor: vendors[0], code: 'finalized', exchangeVersions: generateVersionTiers("Content Management").map(v => v.name) }
        ];
        const moiiDates = [
            'October 19, 2023', 'October 21, 2023', 'November 10, 2023', 'November 28, 2023', 'November 30, 2023'
        ];

        const moiiscripts = [
            { id: 1, name: "Clarity Analytics Tracker v1", purchaseDate: moiiDates[0], status: 'finalized', type: 'Backend', version: 'v1.0', price: 65, vendor: vendors[2], code: 'finalized', exchangeVersions: generateVersionTiers("Analytics Tracker").map(v => v.name) },
            { id: 2, name: "Item Selector UI Box", purchaseDate: moiiDates[1], status: 'finalized', type: 'UI', version: 'v1.2', price: 70, vendor: vendors[3], code: 'finalized', exchangeVersions: generateVersionTiers("Item Selector UI Box").map(v => v.name) },
            { id: 3, name: "Newsletter Caching Database Configurations ", purchaseDate: moiiDates[2], status: 'finalized', type: 'Backend', version: 'v2.1', price: 68, vendor: vendors[4], code: 'finalized', exchangeVersions: generateVersionTiers("Inventory System").map(v => v.name) },
            { id: 4, name: "Redis Caching Layer Throttling v1", purchaseDate: moiiDates[3], status: 'finalized', type: 'Backend', version: 'v2.5', price: 72, vendor: vendors[5], code: 'finalized', exchangeVersions: generateVersionTiers("Booking Engine").map(v => v.name) },
            { id: 5, name: "VideoMatic Auto-Manual", purchaseDate: moiiDates[4], status: 'finalized', type: 'Frontend', version: 'v3.0', price: 65, vendor: vendors[0], code: 'finalized', exchangeVersions: generateVersionTiers("Content Management").map(v => v.name) }
        ];

        const projectsData = {
            "blinkbag.com": { scripts: Blinkbag },
            "Moii.ai": { scripts: moiiscripts },
            "olivireWilson.com": { scripts: olivireWilsonScripts },
            "eliHealth.in": { scripts: eliHealthScripts },
            
        };

        function generateRandomVersionName() {
            const names = ['Community', 'Standard', 'Business', 'Ultimate', 'Lite', 'Pro', 'Atomic', 'Quantum'];
            const v1 = Math.floor(Math.random() * 3) + 1;
            const v2 = Math.floor(Math.random() * 10);
            const v3 = Math.floor(Math.random() * 10);
            const name = names[Math.floor(Math.random() * names.length)];
            return `v${v1}.${v2}.${v3} (${name})`;
        }

        function generateVersionTiers(scriptName) {
            const price1 = getDeterministicPrice(scriptName + "-tier1", 70, 120);
            const price2 = getDeterministicPrice(scriptName + "-tier2", 121, 200);
            const price3 = getDeterministicPrice(scriptName + "-tier3", 201, 300);
            return [{ name: generateRandomVersionName(), price: price1 }, { name: generateRandomVersionName(), price: price2 }, { name: generateRandomVersionName(), price: price3 }].sort((a, b) => a.price - b.price);
        }

        // --- DOM ELEMENTS & STATE (full list) ---
        const allPages = {
            loginPage: document.getElementById('login-page'),
            homePage: document.getElementById('home-page'),
            portalMain: document.getElementById('portal-main'),
            checkoutPage: document.getElementById('checkout-page'),
            paymentsPage: document.getElementById('payments-page'),
            accountPage: document.getElementById('account-page')
        };
        const loginForm = document.getElementById('login-form');
        const passwordInput = document.getElementById('password');
        const errorMessage = document.getElementById('error-message');
        const projectFoldersContainer = document.getElementById('project-folders-container');
        const backToProjectsBtn = document.getElementById('back-to-projects-btn');
        const currentProjectName = document.getElementById('current-project-name');
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabPanes = document.querySelectorAll('.tab-pane');
        const subTabButtons = document.querySelectorAll('.sub-tab-button');
        const exchangeModal = document.getElementById('exchange-modal');
        const closeModalButton = document.getElementById('close-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalVersionList = document.getElementById('modal-version-list');
        const devScriptsList = document.getElementById('dev-scripts-list');
        const invoiceList = document.getElementById('invoice-list');
        const getScriptsList = document.getElementById('get-scripts-list');
        const updateScriptsContent = document.getElementById('update-scripts-content');
        const paginationControls = document.getElementById('pagination-controls');
        const profileMenuButton = document.getElementById('profile-menu-button');
        const profileMenu = document.getElementById('profile-menu');
        const finalizeConfirmModal = document.getElementById('finalize-confirm-modal');
        const confirmProceedBtn = document.getElementById('confirm-proceed-btn');
        const confirmCancelBtn = document.getElementById('confirm-cancel-btn');
        const sortScriptsDropdown = document.getElementById('sort-scripts');
        const loadingOverlay = document.getElementById('loading-overlay');
        const accountLink = document.getElementById('account-link');
        const paymentsLink = document.getElementById('payments-link');
        const backToPortalFromAccountBtn = document.getElementById('back-to-portal-from-account');
        const backToPortalFromPaymentsBtn = document.getElementById('back-to-portal-from-payments');
        const totalInvestmentAmount = document.getElementById('total-investment-amount');
        const dateFromInput = document.getElementById('date-from');
        const dateToInput = document.getElementById('date-to');
        const filterDateBtn = document.getElementById('filter-date-btn');
        const clearFilterBtn = document.getElementById('clear-filter-btn');
        const backToPortalBtn = document.getElementById('back-to-portal');
        const checkoutItemName = document.getElementById('checkout-item-name');
        const checkoutItemPrice = document.getElementById('checkout-item-price');
        const checkoutTotalPrice = document.getElementById('checkout-total-price');
        const applyPromoBtn = document.getElementById('apply-promo');
        const promoCodeInput = document.getElementById('promo-code');
        const promoMessage = document.getElementById('promo-message');
        const discountRow = document.getElementById('discount-row');
        const loader = document.getElementById('loader');
        const finalPayBtn = document.getElementById('final-pay-btn');

        let currentProject = null, currentPage = 1, activeSubTab = 'frontend', currentCheckout = { price: 0, discountApplied: false }, scriptIdToFinalize = null, currentSort = 'date-desc', costPieChart = null, costBarChart = null, totalCostPieChart = null, totalCostBarChart = null, dateFromFilter = null, dateToFilter = null;
        const itemsPerPage = 9;

        // --- HELPER FUNCTIONS ---
        function formatCurrency(usdAmount) {
            return `$${(usdAmount || 0).toFixed(2)}`;
        }

        // --- CHARTING FUNCTIONS ---
        function renderTotalCostAnalytics() {
            if (!currentProject) return;
            if (totalCostPieChart) totalCostPieChart.destroy();
            if (totalCostBarChart) totalCostBarChart.destroy();
            let breakdown = { frontend: 0, backend: 0, cms: 0, server: 0 };
            projectsData[currentProject].scripts.forEach(script => {
                console.log(currentProject)
               if(currentProject=='blinkbag.com'){
                let feP = (script.type === 'Frontend') ? 0.6 : 0.15;
                let beP = (script.type === 'Backend') ? 0.6 : 0.35;
                breakdown.frontend += script.price * 0;
                breakdown.backend = 529;
                breakdown.cms = 181;
                breakdown.server =172;
               }
               else{
                let feP = (script.type === 'Frontend') ? 0.6 : 0.15;
                let beP = (script.type === 'Backend') ? 0.6 : 0.15;
                breakdown.frontend += script.price * feP;
                breakdown.backend += script.price * beP;
                breakdown.cms += script.price * 0.15;
                breakdown.server += script.price * 0.10;
               }
                
            });
            const dataValues = [breakdown.frontend.toFixed(2), breakdown.backend.toFixed(2), breakdown.cms.toFixed(2), breakdown.server.toFixed(2)];
            const chartData = { labels: ['Frontend', 'Backend', 'Data CMS', 'Server'], datasets: [{ data: dataValues, backgroundColor: ['#4bc0c0', '#ff6384', '#ffcd56', 'green'] }] };
            const pieCtx = document.getElementById('total-cost-pie-chart').getContext('2d');
            totalCostPieChart = new Chart(pieCtx, { type: 'pie', data: chartData, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' }, title: { display: true, text: 'Overall Spending (Pie)' } } } });
            const barCtx = document.getElementById('total-cost-bar-chart').getContext('2d');
            totalCostBarChart = new Chart(barCtx, { type: 'bar', data: chartData, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, title: { display: true, text: 'Overall Spending (Bar)' } } } });
        }

        function renderPaymentsPage() {
            if (!currentProject) return;
            const totalInvestment = projectsData[currentProject].scripts.reduce((sum, script) => sum + parseFloat(script.price || 0), 0);
            totalInvestmentAmount.textContent = formatCurrency(totalInvestment);
            renderTotalCostAnalytics();
        }
        var ip=''
        function user_location() {
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                  
                    ip=this.responseText
                    }
                };
                xhttp.open("GET", "https://api.db-ip.com/v2/free/self", true);
                xhttp.send();
        }
        user_location()
        // --- LOGIN & PAGE NAVIGATION ---
        loginForm.addEventListener('submit', function (event) {
            event.preventDefault();
            if (passwordInput.value === '831903pass') {
                // FIXED: Wrapped JSON parsing in a try-catch to prevent crashes if IP fetch fails
                let newip = {};
                try {
                    if(ip) {
                        newip = JSON.parse(ip);
                    }
                } catch(e) {
                    console.log("IP fetch failed or parsing error", e);
                }
             
                // if(newip.ipAddress=='117.217.85.56'&&newip.continentName=="Asia"){
                                    // Show loader, hide login page
                        loader.style.display = 'inline-grid';
                        allPages.loginPage.style.display = 'none';
                        setTimeout(() => {
                            loader.style.display = 'none';
                            showPage(allPages.homePage);
                            renderHomePage();
                        }, 1500);
               // }
                // else{
                //     errorMessage.textContent = 'Sorry ,Your Identity is Not Matching .\nThis Portal Does not belongs to you';
                // setTimeout(() => { errorMessage.textContent = ''; }, 3000);
                // }

            } else {
                errorMessage.textContent = 'Invalid Password';
                setTimeout(() => { errorMessage.textContent = ''; }, 3000);
            }
        });
        profileMenuButton.addEventListener('click', () => profileMenu.classList.toggle('hidden'));
        window.addEventListener('click', (e) => {
            if (profileMenuButton && !profileMenuButton.contains(e.target) && profileMenu && !profileMenu.contains(e.target)) {
                profileMenu.classList.add('hidden');
            }
        });
        function showPage(pageToShow) {
            Object.values(allPages).forEach(page => page.classList.add('hidden'));
            if (pageToShow) pageToShow.classList.remove('hidden');
        }
        accountLink.addEventListener('click', (e) => { e.preventDefault(); profileMenu.classList.add('hidden'); showPage(allPages.accountPage); });
        paymentsLink.addEventListener('click', (e) => { e.preventDefault(); profileMenu.classList.add('hidden'); if (currentProject) { showPage(allPages.paymentsPage); renderPaymentsPage(); } else { alert('Please select a project first.'); } });
        backToProjectsBtn.addEventListener('click', () => { currentProject = null; showPage(allPages.homePage); });
        backToPortalFromAccountBtn.addEventListener('click', () => currentProject ? showPage(allPages.portalMain) : showPage(allPages.homePage));
        backToPortalFromPaymentsBtn.addEventListener('click', () => showPage(allPages.portalMain));
        backToPortalBtn.addEventListener('click', () => showPage(allPages.portalMain));

        // --- TAB & RENDER FUNCTIONS ---
        function initializeTabs() {
            tabButtons.forEach(btn => btn.classList.remove('tab-active'));
            tabPanes.forEach(pane => pane.classList.add('hidden'));
            if (tabButtons.length > 0) {
                tabButtons[0].classList.add('tab-active');
                document.getElementById(`${tabButtons[0].dataset.tab}-tab`).classList.remove('hidden');
            }
        }

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.dataset.tab;
                tabButtons.forEach(btn => btn.classList.remove('tab-active'));
                tabPanes.forEach(pane => pane.classList.add('hidden'));
                button.classList.add('tab-active');
                document.getElementById(`${tabId}-tab`).classList.remove('hidden');

                if (tabId === 'update') {
                    renderUpdateScriptsTab();
                }
            });
        });

        subTabButtons.forEach(button => {
            button.addEventListener('click', () => {
                activeSubTab = button.dataset.subtab;
                subTabButtons.forEach(btn => btn.classList.remove('sub-tab-active'));
                button.classList.add('sub-tab-active');
                currentPage = 1;
                renderGetScriptsPage(currentPage);
                renderPagination();
            });
        });

        function renderHomePage() {
            projectFoldersContainer.innerHTML = '';
            Object.keys(projectsData).forEach(projectName => {
                projectFoldersContainer.insertAdjacentHTML('beforeend', `
                    <div class="project-folder modern-card-hover flex flex-col items-center justify-center p-6 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200 hover:border-indigo-500 hover:bg-white cursor-pointer" data-project="${projectName}">
                        <svg class="w-16 h-16 text-gray-400 folder-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" /></svg>
                        <p class="mt-2 text-sm font-semibold text-gray-700">${projectName}</p>
                        <p class="text-xs text-gray-500">${projectsData[projectName].scripts.length} scripts</p>
                    </div>`);
            });
        }

        function renderDevScripts() {
            if (!currentProject) return;

            let scripts = projectsData[currentProject].scripts;
            let filteredAndSortedScripts = getFilteredAndSortedScripts(scripts);

            devScriptsList.innerHTML = '';
            if (filteredAndSortedScripts.length === 0) {
                devScriptsList.innerHTML = `<div class="text-center py-10 bg-gray-50 rounded-lg"><p class="text-gray-500">No scripts found for the selected criteria.</p></div>`;
                return;
            }

            filteredAndSortedScripts.forEach(script => {
                const isFinalized = script.status === 'finalized';
                devScriptsList.insertAdjacentHTML('beforeend', `
                    <div class="bg-white border border-gray-200 rounded-lg">
                        <details>
                            <summary class="flex flex-col md:flex-row items-center justify-between p-4 cursor-pointer">
                                <div class="flex items-center"><span class="arrow mr-3 text-gray-400">&#9654;</span><p class="font-semibold text-gray-700">${script.name}</p></div>
                                <div class="flex items-center space-x-3 mt-3 md:mt-0">
                                    <button class="px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg">Paid</button>
                                    <button class="exchange-btn px-4 py-2 text-sm font-medium text-white rounded-lg ${isFinalized ? 'bg-gray-500 cursor-not-allowed' : 'bg-gray-600 hover:bg-gray-700'}" data-script-id="${script.id}" ${isFinalized ? 'disabled' : ''}>Exchange</button>
                                </div>
                            </summary>
                            <div class="p-4 border-t border-gray-200 bg-gray-50 space-y-3 text-sm text-gray-600">
                               <div class="space-y-1"><p><strong>Type:</strong> ${script.type}</p><p><strong>Vendor:</strong> ${script.vendor}</p><p><strong>Version:</strong> ${script.version}</p><p><strong>Price:</strong> ${formatCurrency(script.price)}</p><p><strong>Purchase Date:</strong> ${script.purchaseDate}</p></div>
                               <div class="mt-2"><label class="font-semibold text-gray-700">Code Snippet:</label><div class="flex items-center space-x-2 mt-1"><textarea id="code-${script.id}" rows="4" class="w-full p-2 font-mono text-xs bg-white border border-gray-300 rounded-lg resize-none" readonly>${script.code}</textarea><button class="copy-code-btn self-start px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300" data-script-id="${script.id}">Copy</button></div></div>
                            </div>
                        </details>
                    </div>`);
            });
        }


        function getFilteredAndSortedScripts(scripts) {
            let filteredScripts = [...scripts];

            if (dateFromFilter) { filteredScripts = filteredScripts.filter(s => new Date(s.purchaseDate) >= dateFromFilter); }
            if (dateToFilter) { filteredScripts = filteredScripts.filter(s => new Date(s.purchaseDate) <= dateToFilter); }

            switch (currentSort) {
                case 'date-desc': filteredScripts.sort((a, b) => new Date(b.purchaseDate) - new Date(a.purchaseDate)); break;
                case 'date-asc': filteredScripts.sort((a, b) => new Date(a.purchaseDate) - new Date(b.purchaseDate)); break;
                case 'price-desc': filteredScripts.sort((a, b) => b.price - a.price); break;
                case 'price-asc': filteredScripts.sort((a, b) => a.price - b.price); break;
                case 'name-asc': filteredScripts.sort((a, b) => a.name.localeCompare(b.name)); break;
                case 'name-desc': filteredScripts.sort((a, b) => b.name.localeCompare(a.name)); break;
            }
            return filteredScripts;
        }

        function renderContent() {
            if (!currentProject) return;

            renderDevScripts();

            invoiceList.innerHTML = '';
            const filteredAndSortedScripts = getFilteredAndSortedScripts(projectsData[currentProject].scripts);
            const paidScripts = filteredAndSortedScripts.filter(s => s.status === 'paid' || s.status === 'finalized');

            if (paidScripts.length === 0) {
                invoiceList.innerHTML = `<div class="flex items-center justify-center h-64 bg-gray-50 rounded-lg"><p class="text-lg text-gray-500">No paid items to show.</p></div>`;
            } else {
                paidScripts.forEach(script => {
                    let invoiceStatusHTML;
                    if (script.status === 'paid') {
                        invoiceStatusHTML = `<div class="text-center md:text-right"><p class="text-sm text-yellow-600 font-semibold">Status: Code is not finalized</p></div><button class="finalize-btn mt-3 md:mt-0 px-4 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg" data-script-id="${script.id}">Finalize Code</button>`;
                    } else {
                        invoiceStatusHTML = `<div class="text-center md:text-right"><p class="text-sm text-green-600 font-semibold">Status: Code has been finalized</p></div><button class="get-receipt-btn mt-3 md:mt-0 px-4 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700 rounded-lg" data-script-id="${script.id}">Get Receipt</button>`;
                    }
                    invoiceList.insertAdjacentHTML('beforeend', `
                        <div class="flex flex-col md:flex-row items-center justify-between p-4 bg-gray-50 border border-gray-200 rounded-lg">
                            <div class="text-center md:text-left mb-3 md:mb-0">
                               <p class="font-semibold text-gray-700">Invoice for: ${script.name}</p>
                               <p class="text-sm text-gray-500">Version: ${script.version} | Price: ${formatCurrency(script.price)} | Vendor: ${script.vendor}</p>
                               <p class="text-sm text-gray-500">Purchased: ${script.purchaseDate}</p>
                            </div>
                            <div class="flex flex-col md:flex-row items-center md:space-x-4">${invoiceStatusHTML}</div>
                        </div>`);
                });
            }
            renderUpdateScriptsTab();
        }

        function renderUpdateScriptsTab() {
            if (!currentProject) {
                updateScriptsContent.innerHTML = `<p class="text-gray-500">Please select a project first.</p>`;
                return;
            }
            const scripts = projectsData[currentProject].scripts;
            const isAnyScriptNotFinalized = scripts.some(script => script.status !== 'finalized');

            if (isAnyScriptNotFinalized) {
                updateScriptsContent.innerHTML = `<p class="text-lg text-yellow-600 font-semibold">Updates will be appear after Finalize Your whole Project</p>`;
            } else {
                updateScriptsContent.innerHTML = `<p class="text-lg text-green-600 font-semibold">All Scripts Has Been Up to Date. Nothing To Update Here</p>`;
            }
        }


        function renderGetScriptsPage(page) {
            getScriptsList.innerHTML = '';
            let scriptsToDisplay;
            switch (activeSubTab) {
                case 'frontend': scriptsToDisplay = getScripts.filter(s => s.type === 'Frontend'); break;
                case 'backend': scriptsToDisplay = getScripts.filter(s => s.type === 'Backend'); break;
                case 'nodejs': scriptsToDisplay = getScripts.filter(s => s.type === 'nodejs'); break;
                case 'ui': scriptsToDisplay = uiScripts; break;
                case 'database': scriptsToDisplay = databaseScripts; break;
            }

            const totalPages = Math.ceil(scriptsToDisplay.length / itemsPerPage);
            currentPage = Math.max(1, Math.min(page, totalPages));
            const paginatedScripts = scriptsToDisplay.slice((currentPage - 1) * itemsPerPage, page * itemsPerPage);

            paginatedScripts.forEach(script => {
                let pricingHTML = '';
                if (script.type === 'ui') {
                    pricingHTML = `<div class="text-lg font-bold text-indigo-600">${formatCurrency(script.price)}</div><div class="text-xs text-gray-500">Expires: ${script.expiryDate}</div>`;
                } else if (script.type === 'database') {
                    pricingHTML = `
                        <div>
                            <div class="text-lg font-bold text-indigo-600">${formatCurrency(script.setupPrice)} <span class="text-sm font-normal text-gray-500">Setup Fee</span></div>
                            <div class="text-md font-semibold text-gray-700">$${script.hourlyRate}/hr <span class="text-sm font-normal text-gray-500">Usage Rate</span></div>
                        </div>`;
                } else {
                    const versionOptions = script.versions.map((v, index) => `<option value="${index}">${v.name} - ${formatCurrency(v.price)}</option>`).join('');
                    pricingHTML = `<div><label class="text-sm">Select Version:</label><select id="version-${script.id}" class="w-full mt-1 p-2 border rounded-md">${versionOptions}</select></div>`;
                }

                const buttonText = script.type === 'database' ? 'Pay & Setup' : 'Pay Now';

                getScriptsList.insertAdjacentHTML('beforeend', `
                    <div class="p-4 bg-gray-50 border rounded-lg flex flex-col modern-card-hover">
                        <h3 class="font-semibold text-gray-800 flex-grow">${script.name}</h3>
                        <p class="text-xs text-orange-600 font-medium mt-1">Exchange Rate: $${script.exchangeRate}</p>
                        <div class="mt-3 space-y-3">
                            ${pricingHTML}
                            <button style="color:white;padding:10px;border-radius:20px" class="pay-btn w-full bg-indigo-600 hover:bg-indigo-700" data-script-id="${script.id}">${buttonText}</button>
                        </div>
                    </div>`);
            });
        }

        function renderPagination() {
            let scriptsToDisplay;
            switch (activeSubTab) {
                case 'frontend': scriptsToDisplay = getScripts.filter(s => s.type === 'Frontend'); break;
                case 'backend': scriptsToDisplay = getScripts.filter(s => s.type === 'Backend'); break;
                case 'nodejs': scriptsToDisplay = getScripts.filter(s => s.type === 'nodejs'); break;
                case 'ui': scriptsToDisplay = uiScripts; break;
                case 'database': scriptsToDisplay = databaseScripts; break;
            }
            const totalPages = Math.ceil(scriptsToDisplay.length / itemsPerPage);
            paginationControls.innerHTML = '';
            if (totalPages <= 1) return;

            // Previous button
            paginationControls.insertAdjacentHTML('beforeend', `<button class="pagination-btn" ${currentPage === 1 ? 'disabled' : ''} data-page="${currentPage - 1}">&laquo;</button>`);
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                paginationControls.insertAdjacentHTML('beforeend', `<button class="pagination-btn${i === currentPage ? ' active' : ''}" data-page="${i}">${i}</button>`);
            }
            // Next button
            paginationControls.insertAdjacentHTML('beforeend', `<button class="pagination-btn" ${currentPage === totalPages ? 'disabled' : ''} data-page="${currentPage + 1}">&raquo;</button>`);
        }

        paginationControls.addEventListener('click', function (e) {
            const btn = e.target.closest('.pagination-btn');
            if (btn && btn.dataset.page) {
                const page = parseInt(btn.dataset.page);
                if (!isNaN(page)) {
                    renderGetScriptsPage(page);
                    renderPagination();
                }
            }
        });

        function showCheckout(script, selectedVersionOrPrice) {
            showPage(allPages.checkoutPage);
            let price, itemName;

            if (typeof selectedVersionOrPrice === 'object') { // Frontend/Backend/Node.js script
                price = selectedVersionOrPrice.price;
                itemName = `${script.name} <br> <span class="text-sm text-gray-500">${selectedVersionOrPrice.name}</span>`;
            } else { // UI or Database script
                price = selectedVersionOrPrice;
                itemName = script.name;
            }

            currentCheckout = { price, name: script.name, discountApplied: false, type: script.type };
            checkoutItemName.innerHTML = `${itemName}<br><span class="text-xs text-gray-400">by ${script.vendor}</span>`;

            if (script.type === 'database') {
                checkoutItemPrice.innerHTML = `${formatCurrency(price)} <span class="text-sm text-gray-500">(Setup Fee)</span> + $${script.hourlyRate}/hr`;
            } else {
                checkoutItemPrice.textContent = formatCurrency(price);
            }

            checkoutTotalPrice.textContent = formatCurrency(price);

            // Set a unique, descriptive ID and name on the pay button for item identification
            const sanitizedName = script.name.replace(/\s+/g, '-').replace(/[^a-zA-Z0-9-]/g, '').toLowerCase();
            finalPayBtn.id = `${sanitizedName}-${script.id}`;
            finalPayBtn.name = script.name;

            promoCodeInput.value = '';
            promoMessage.textContent = '';
            discountRow.style.display = 'none';
        }
        function updateTotal() { /* ... */ }
        applyPromoBtn.addEventListener('click', () => { /* ... */ });

        sortScriptsDropdown.addEventListener('change', (event) => { currentSort = event.target.value; renderContent(); });
        filterDateBtn.addEventListener('click', () => {
            dateFromFilter = dateFromInput.value ? new Date(dateFromInput.value) : null;
            dateToFilter = dateToInput.value ? new Date(dateToInput.value) : null;
            if (dateToFilter) { dateToFilter.setHours(23, 59, 59, 999); }
            renderContent();
        });
        clearFilterBtn.addEventListener('click', () => {
            dateFromInput.value = ''; dateToInput.value = '';
            dateFromFilter = null; dateToFilter = null;
            renderContent();
        });

        document.body.addEventListener('click', function (event) {
            const target = event.target;
            const projectFolder = target.closest('.project-folder');

            if (projectFolder) {
                currentProject = projectFolder.dataset.project;
                currentProjectName.textContent = currentProject;
                showPage(allPages.portalMain);
                initializeTabs();
                renderContent();
                renderGetScriptsPage(currentPage);
                renderPagination();
            }
            if (target.classList.contains('exchange-btn')) {
                const scriptId = parseInt(target.getAttribute('data-script-id'));
                const script = projectsData[currentProject].scripts.find(s => s.id === scriptId);
                if (script) openModal(script);
            }
            if (target.classList.contains('exchange-version-link')) {
                event.preventDefault();
                const scriptId = parseInt(target.dataset.scriptId);
                const newVersion = target.dataset.newVersion;
                const script = projectsData[currentProject].scripts.find(s => s.id === scriptId);
                if (script) {
                    script.version = newVersion;
                    script.code = `// Code for ${script.name} ${newVersion}`;
                    closeModal();
                    renderContent();
                }
            }
            if (target.classList.contains('copy-code-btn')) { /* ... */ }
            if (target.classList.contains('finalize-btn')) {
                scriptIdToFinalize = parseInt(target.getAttribute('data-script-id'));
                finalizeConfirmModal.classList.remove('hidden');
            }
            if (target.classList.contains('get-receipt-btn')) {
                const scriptId = parseInt(target.getAttribute('data-script-id'));
                if (currentProject) {
                    const script = projectsData[currentProject].scripts.find(s => s.id === scriptId);
                    if (script) {
                        generateAndDownloadInvoice(script);
                    }
                }
            }
            if (target.classList.contains('pay-btn')) {
                loadingOverlay.classList.remove('hidden');
                const scriptId = parseInt(target.getAttribute('data-script-id'));
                let scriptToBuy = getScripts.find(s => s.id === scriptId) || uiScripts.find(s => s.id === scriptId) || databaseScripts.find(s => s.id === scriptId);

                if (scriptToBuy) {
                    let selectedVersionOrPrice;
                    if (scriptToBuy.versions) {
                        const versionDropdown = document.getElementById(`version-${scriptId}`);
                        selectedVersionOrPrice = scriptToBuy.versions[versionDropdown.value];
                    } else if (scriptToBuy.type === 'database') {
                        selectedVersionOrPrice = scriptToBuy.setupPrice;
                    } else {
                        selectedVersionOrPrice = scriptToBuy.price;
                    }

                    const randomDelay = Math.random() * 2000 + 500;
                    setTimeout(() => {
                        loadingOverlay.classList.add('hidden');
                        showCheckout(scriptToBuy, selectedVersionOrPrice);
                    }, randomDelay);
                } else {
                    loadingOverlay.classList.add('hidden');
                }
            }
        });

        function openModal(script) {
            modalTitle.textContent = `Exchange: ${script.name}`;
            modalVersionList.innerHTML = '';
            
            // Randomly calculate exchange fee
            const exchangeFee = (Math.random() * (20 - 11) + 11).toFixed(2);
            document.getElementById('modal-exchange-fee').textContent = '$' + exchangeFee;

            const availableVersions = script.exchangeVersions || [];
            if (availableVersions.length > 0) {
                availableVersions.forEach(v => {
                    modalVersionList.insertAdjacentHTML('beforeend', `<a href="#" class="exchange-version-link block p-3 bg-gray-100 rounded-lg hover:bg-gray-200" data-new-version="${v}" data-script-id="${script.id}">${v}</a>`);
                });
            } else {
                modalVersionList.innerHTML = '<p class="text-gray-500">No other versions available for exchange.</p>';
            }
            exchangeModal.classList.remove('hidden');
        }
        function closeModal() { exchangeModal.classList.add('hidden'); }
        closeModalButton.addEventListener('click', closeModal);
        exchangeModal.addEventListener('click', (e) => { if (e.target === exchangeModal) closeModal(); });

        function closeFinalizeModal() { finalizeConfirmModal.classList.add('hidden'); scriptIdToFinalize = null; }
        confirmCancelBtn.addEventListener('click', closeFinalizeModal);
        
        function generateAndDownloadInvoice(script) {
            if (!script) return;
            generatePDF(script) 
        }
        function generateInvoiceNumber(date) {
            const purchaseDateVal = date;
            const year = purchaseDateVal ? new Date(purchaseDateVal).getFullYear() : new Date().getFullYear();
            const randomDigits = Math.floor(10000 + Math.random() * 90000);
            return `${year}${randomDigits}`;
        }

        function updateExpiryDate(date) {
            const purchaseDateVal = date;
            if (purchaseDateVal) {
                const date = new Date(purchaseDateVal);
                date.setFullYear(date.getFullYear() + 1);
                let exdate=new Date(date)
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                const formattedDate = exdate.toLocaleDateString('en-US', options)
                return formattedDate;
            }
        }
        function drawBackground(doc) {
            doc.setDrawColor(245, 245, 245);
            doc.setLineWidth(0.1);
            for (let i = 0; i < 400; i += 15) {
                doc.line(0, i, i, 0);
                doc.line(210 - i, 297, 210, 297 - i);
            }
        }
        async function generatePDF(script) {
            const statusMsg = document.getElementById('statusMsg');
            const jspdfLib = window.jspdf || (window.window && window.window.jspdf);

            if (!jspdfLib) {
                statusMsg.innerText = "Error: Library not loaded.";
                return;
            }

            try {
                //console.log("Purchase Date:", script.purchaseDate)
                const itemsArray = [{ "itemDescription":`${script.name} - Version: ${script.version}`,
                 "itemVendor":script.vendor, 
                 "itemPrice":script.price, 
                 "itemQuantity": 1, 
                 "totalFinalPrice": script.price }]
                // console.log(JSON.stringify(itemsArray))
                // console.log("ProjectName:",currentProject)
                const invoiceData = {
                    metadata: {
                        domain: "www.codlokon.space",
                        generatedAt: new Date().toISOString()
                    },
                    header: {
                        invoiceNumber: generateInvoiceNumber(script.purchaseDate),
                        orderNumber: 'ORD-'+Math.floor(Math.random() * 1000) + 1,
                        purchaseDate: script.purchaseDate || 'N/A',
                        expiryDate: updateExpiryDate(script.purchaseDate) || 'N/A'
                    },
                    sender: {
                        companyName: "Codlokon.space"
                    },
                    client: {
                        name: 'Mr.Nakul Singh',
                        address: 'Soumya Heritage Bhopal,462026,M.P,India',
                        projectId: currentProject
                    },
                    payment: {
                        method: "Visa Card",
                        cardNumber: 'XXXX XXXX XXXX 6673',
                        maskedCard: (function (num) {
                            return num.length >= 4 ? '**** **** **** ' + num.slice(-4) : '****';
                        })('XXXX XXXX XXXX 6673')
                    },
                    lineItems: itemsArray,
                    financials: {
                        currency: '$',
                        taxRate: 0
                    }
                };

                // TAX-INCLUSIVE CALCULATION LOGIC
                // The Sum of items is the Final Price (Grand Total)
                const totalInclusive = invoiceData.lineItems.reduce((sum, item) => sum + item.totalFinalPrice, 0);
                const taxRate = invoiceData.financials.taxRate;

                invoiceData.financials.grandTotal = totalInclusive;
                // Subtotal = Total / (1 + Rate)
                invoiceData.financials.subtotal = totalInclusive / (1 + (taxRate / 100));
                // Tax = Total - Subtotal
                invoiceData.financials.taxAmount = totalInclusive - invoiceData.financials.subtotal;

                const { jsPDF } = jspdfLib;
                const doc = new jsPDF();
                const headerGray = [51, 65, 85];
                const accentGray = [100, 116, 139];
                const lightText = [241, 245, 249];
                const darkText = [30, 41, 59];
               
                drawBackground(doc);

                doc.setFillColor(...headerGray);
                doc.rect(0, 0, 210, 60, 'F');
                doc.setDrawColor(94, 110, 131);
                doc.setLineWidth(0.5);
                doc.line(0, 0, 60, 60);
                doc.line(210, 0, 150, 60);

                doc.setTextColor(...lightText);
                doc.setFontSize(8);
                doc.text(invoiceData.metadata.domain, 105, 8, { align: 'center' });
                doc.setFontSize(28);
                doc.setFont('helvetica', 'bold');
                doc.text('INVOICE', 20, 32);

                doc.setFontSize(9);
                doc.setFont('helvetica', 'normal');
                doc.text('INVOICE NO.', 190, 22, { align: 'right' });
                doc.setFont('helvetica', 'bold');
                doc.text(invoiceData.header.invoiceNumber, 190, 27, { align: 'right' });

                doc.setFont('helvetica', 'normal');
                doc.text('DATE OF PURCHASE', 190, 34, { align: 'right' });
                doc.setFont('helvetica', 'bold');
                doc.text(invoiceData.header.purchaseDate, 190, 39, { align: 'right' });

                doc.setFont('helvetica', 'normal');
                doc.text('EXPIRY DATE', 190, 46, { align: 'right' });
                doc.setFont('helvetica', 'bold');
                doc.text(invoiceData.header.expiryDate, 190, 51, { align: 'right' });

                doc.setTextColor(...darkText);
                doc.setFontSize(10);
                doc.setFont('helvetica', 'bold');
                doc.text('ISSUED BY:', 20, 75);
                doc.setFont('helvetica', 'normal');
                doc.text(invoiceData.sender.companyName, 20, 81);

                doc.setFont('helvetica', 'bold');
                doc.text('ORDER NO:', 20, 90);
                doc.setFont('helvetica', 'normal');
                doc.text(invoiceData.header.orderNumber, 45, 90);

                doc.setFont('helvetica', 'bold');
                doc.text('BILL TO:', 120, 75);
                doc.setFont('helvetica', 'normal');
                doc.text(invoiceData.client.name, 120, 81);
                doc.setFontSize(9);
                doc.text(invoiceData.client.address, 120, 86, { maxWidth: 70 });
                  // Project Details Styled to match theme
                  const rightColX = 120;
                doc.setFontSize(9);
               
                doc.setTextColor(...darkText);
                doc.setFont('helvetica', 'bold');
                doc.text('PROJECT ID:', rightColX, 100);
                
                doc.setTextColor(...accentGray);
                doc.setFont('helvetica', 'normal');
                doc.text(invoiceData.client.projectId, rightColX + 22, 100);
                
                doc.setFontSize(8);
                doc.setFont('helvetica', 'italic');
                doc.setTextColor(100, 116, 139);
                doc.text('(Code script purchased for project attribution)', rightColX, 105);

                doc.setFontSize(10);
                doc.setTextColor(...darkText);
                doc.setFont('helvetica', 'bold');
                doc.text('PAYMENT SOURCE:', 20, 105);
                doc.setFont('helvetica', 'normal');
                doc.text(`${invoiceData.payment.method} | ${invoiceData.payment.maskedCard}`, 60, 105);

                let currentY = 115;
                doc.setFillColor(241, 245, 249);
                doc.rect(20, currentY, 170, 10, 'F');
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(9);
                doc.setTextColor(...darkText);
                doc.text('DESCRIPTION', 25, currentY + 6.5);
                doc.text('VENDOR', 85, currentY + 6.5);
                doc.text('QTY', 125, currentY + 6.5);
                doc.text('PRICE', 145, currentY + 6.5);
                doc.text('TOTAL', 170, currentY + 6.5);

                currentY += 10;
                doc.setFont('helvetica', 'normal');
                invoiceData.lineItems.forEach(item => {
                    // Split text into wrapped lines for description and vendor
                    const descLines = doc.splitTextToSize(item.itemDescription, 55);
                    const vendorLines = doc.splitTextToSize(item.itemVendor, 35);
                    
                    // Determine the height needed for this row
                    const maxLines = Math.max(descLines.length, vendorLines.length);
                    const rowHeight = (maxLines * 5) + 2; 

                    if (currentY + rowHeight > 270) {
                        doc.addPage();
                        drawBackground(doc);
                        currentY = 20;
                    }

                    // Render lines
                    doc.text(descLines, 25, currentY + 5);
                    doc.text(vendorLines, 85, currentY + 5);
                    
                    // Render other columns
                    doc.text(item.itemQuantity.toString(), 125, currentY + 5);
                    doc.text(invoiceData.financials.currency + item.itemPrice.toLocaleString(), 145, currentY + 5);
                    doc.text(invoiceData.financials.currency + item.totalFinalPrice.toLocaleString(), 170, currentY + 5);
                    
                    doc.setDrawColor(220, 225, 230);
                    doc.line(20, currentY + rowHeight, 190, currentY + rowHeight);
                    
                    currentY += rowHeight;
                });

                currentY += 15;
                const summaryX = 135;
                const boxWidth = 65;
                const boxHeight = 14;

                doc.setFontSize(10);
                doc.text('Price (Incl. Tax):', summaryX + 5, currentY);
                doc.text(invoiceData.financials.currency + invoiceData.financials.subtotal.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 }), 195, currentY, { align: 'right' });

                currentY += 7;
                
                currentY += 10;

                // Total Box Shadow
                doc.setFillColor(220, 225, 230);
                doc.roundedRect(summaryX + 1, currentY - 6.5, boxWidth, boxHeight, 2, 2, 'F');

                // Total Box Main
                doc.setFillColor(...headerGray);
                doc.roundedRect(summaryX, currentY - 8, boxWidth, boxHeight, 2, 2, 'F');

                doc.setTextColor(...lightText);
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(11);

                // Box Content
                doc.text('TOTAL AMOUNT:', summaryX + 5, currentY + 1);
                doc.setFontSize(12);
                doc.text(invoiceData.financials.currency + invoiceData.financials.grandTotal.toLocaleString(), summaryX + boxWidth - 5, currentY + 1, { align: 'right' });

                // New Heading below total box
               
                
 
                // Footer
                doc.setTextColor(100, 16, 39);
                doc.setFontSize(8);
                doc.setFont('helvetica', 'italic');
                doc.text('Note:In order to exchange Script Additional Charges Will be Apply', 105, 275, { align: 'center' });
                
                doc.setTextColor(100, 116, 139);
                doc.setFontSize(8);
                doc.setFont('helvetica', 'italic');
                doc.text('This is a system generated invoice', 105, 289, { align: 'center' });

                doc.save(`${invoiceData.header.invoiceNumber}_Invoice.pdf`);
                //statusMsg.innerText = "PDF Generated: Tax-Inclusive Model";
            } catch (err) {
                console.error(err);
                
            }
        }
        confirmProceedBtn.addEventListener('click', () => {
            if (scriptIdToFinalize !== null && currentProject) {
                const scriptToFinalize = projectsData[currentProject].scripts.find(s => s.id === scriptIdToFinalize);
                if (scriptToFinalize) {
                    generateAndDownloadInvoice(scriptToFinalize);
                    scriptToFinalize.status = 'finalized';
                    renderContent();
                }
            }
            closeFinalizeModal();
        });
        
        var linkCodes={
            "Sign & Log User Authentication e6":"https://www.codester.com/items/payment?id=43769&extended=true",
            "MOLD pro Admin Panel":"https://www.codester.com/items/payment?id=56719&extended=true",
            "LARACRUD Admin 6th Level":"https://www.codester.com/items/payment?id=37936&extended=true",
        "Gravity Template setup":"https://www.templatemonster.com/checkout/",
    "Payment Plugin for Ruoom - Django":"https://www.codester.com/items/payment?id=56287&extended=true",}
        finalPayBtn.addEventListener('click', () => {
            let link=linkCodes[currentCheckout.name.split("-")[0].trim()]
            const stripeLink =link 
            console.log(finalPayBtn.name,currentCheckout)
            console.log(link)
           
            window.location.href = stripeLink;
            
        });

    </script>
</body>

</html>
